
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Sora">
      
      
        <meta name="author" content="Yuriever">
      
      
        <link rel="canonical" href="https://yuriever.github.io/symbolic/misc/misc/">
      
      
      
      
      <link rel="icon" href="../../../img/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Miscellaneous - Sora</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Helvetica+Neue:300,300i,400,400i,700,700i%7CSource+Code+Pro+Semibold:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Helvetica Neue";--md-code-font:"Source Code Pro Semibold"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/const.css">
    
      <link rel="stylesheet" href="../../../css/theme-color.css">
    
      <link rel="stylesheet" href="../../../css/misc.css">
    
      <link rel="stylesheet" href="../../../css/list.css">
    
      <link rel="stylesheet" href="../../../css/heading.css">
    
      <link rel="stylesheet" href="../../../css/code.css">
    
      <link rel="stylesheet" href="../../../css/table.css">
    
      <link rel="stylesheet" href="../../../css/image.css">
    
      <link rel="stylesheet" href="../../../css/mathjax.css">
    
      <link rel="stylesheet" href="../../../css/footnote.css">
    
      <link rel="stylesheet" href="../../../css/box-format.css">
    
      <link rel="stylesheet" href="../../../css/box-type.css">
    
      <link rel="stylesheet" href="../../../css/tikzjax/fonts.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="sora" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#miscellaneous" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Sora" class="md-header__button md-logo" aria-label="Sora" data-md-component="logo">
      
  <img src="../../../img/Mutsumi1.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Sora
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Miscellaneous
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="sora" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../" class="md-tabs__link">
        
  
  
    
  
  Triangulated reality

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../lightnovel/" class="md-tabs__link">
        
  
  
    
  
  Lightnovel

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../workbench/" class="md-tabs__link">
        
  
  
    
  
  Workbench

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../sora/" class="md-tabs__link">
        
  
  
    
  
  Sora

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
  
    <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
        <div class="md-sidebar__scrollwrap">
            <div class="md-sidebar__inner">
                


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Sora" class="md-nav__button md-logo" aria-label="Sora" data-md-component="logo">
      
  <img src="../../../img/Mutsumi1.png" alt="logo">

    </a>
    Sora
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Triangulated reality
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lightnovel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lightnovel
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../workbench/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Workbench
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../sora/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sora
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
            </div>
        </div>
    </div>
  
  
    
    <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
        <div class="md-sidebar__scrollwrap">
            <div class="md-sidebar__inner">
                

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#replace-vs-replaceall" class="md-nav__link">
    <span class="md-ellipsis">
      Replace vs. ReplaceAll
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#decoupling" class="md-nav__link">
    <span class="md-ellipsis">
      Decoupling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#helper-function" class="md-nav__link">
    <span class="md-ellipsis">
      Helper function
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hold-like-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Hold-like attributes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set-in-package" class="md-nav__link">
    <span class="md-ellipsis">
      Set in package
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#public-variable" class="md-nav__link">
    <span class="md-ellipsis">
      Public variable
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
            </div>
        </div>
    </div>
  

          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  <!--
  Copyright (c) 2016-2023 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Tags -->


<!-- Actions -->


<!--
  Check whether the content starts with a level 1 headline. If it doesn't, the
  page title (or respectively site name) is used as the main headline.
-->

<!-- 
  update to version 9.x
  https://github.com/squidfunk/mkdocs-material/pull/4628/files#diff-db74d007cdd9552f496a973903f6c0d75c034d53d76dd94ffed01926cb6e9f2a 
-->
<!---->

<!-- Page content -->
<h1 id="miscellaneous">Miscellaneous</h1>
<h2 id="replace-vs-replaceall">Replace vs. ReplaceAll</h2>
<p><code class="highlight"><span class="nb">ReplaceAll</span></code> 的策略是从外到内、广度优先的，匹配完的子表达式不再被匹配；
<code class="highlight"><span class="nb">Replace</span></code> 访问表达式的策略是从内到外、深度优先的。
此外，<code class="highlight"><span class="nb">Replace</span></code> 的默认选项为 <code class="highlight"><span class="nb">Heads</span><span class="o">-&gt;</span><span class="nb">False</span></code>。
例如：</p>
<div class="admonition wl">
<p class="admonition-title">Example</p>
<div class="highlight"><pre><span></span><code><span class="nb">ReplaceAll</span><span class="p">[</span><span class="nv">f</span><span class="p">[</span><span class="nv">f</span><span class="p">[</span><span class="nv">x</span><span class="p">]],</span><span class="nv">f</span><span class="p">[</span><span class="nt">x_</span><span class="p">]</span><span class="o">:&gt;</span><span class="nv">g</span><span class="p">[</span><span class="nv">x</span><span class="p">]]</span>

<span class="nb">ReplaceAll</span><span class="p">[</span><span class="nv">f</span><span class="p">[</span><span class="nv">f</span><span class="p">[</span><span class="nv">x</span><span class="p">]],</span><span class="nv">f</span><span class="o">-&gt;</span><span class="nv">g</span><span class="p">]</span>

<span class="nb">Replace</span><span class="p">[</span><span class="nv">f</span><span class="p">[</span><span class="nv">f</span><span class="p">[</span><span class="nv">x</span><span class="p">]],</span><span class="nv">f</span><span class="p">[</span><span class="nt">x_</span><span class="p">]</span><span class="o">:&gt;</span><span class="nv">g</span><span class="p">[</span><span class="nv">x</span><span class="p">],</span><span class="nb">All</span><span class="p">]</span>

<span class="nb">Replace</span><span class="p">[</span><span class="nv">f</span><span class="p">[</span><span class="nv">f</span><span class="p">[</span><span class="nv">x</span><span class="p">]],</span><span class="nv">f</span><span class="o">-&gt;</span><span class="nv">g</span><span class="p">,</span><span class="nb">All</span><span class="p">,</span><span class="nb">Heads</span><span class="o">-&gt;</span><span class="nb">True</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nb">Out</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">g</span><span class="p">[</span><span class="nv">f</span><span class="p">[</span><span class="nv">x</span><span class="p">]]</span>

<span class="nb">Out</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">g</span><span class="p">[</span><span class="nv">g</span><span class="p">[</span><span class="nv">x</span><span class="p">]]</span>

<span class="nb">Out</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">g</span><span class="p">[</span><span class="nv">g</span><span class="p">[</span><span class="nv">x</span><span class="p">]]</span>

<span class="nb">Out</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">g</span><span class="p">[</span><span class="nv">g</span><span class="p">[</span><span class="nv">x</span><span class="p">]]</span>
</code></pre></div>
</div>
<p>对于 <code class="highlight"><span class="nb">ReplaceAll</span></code> 而言，一方面，规则 <code class="highlight"><span class="p">{</span><span class="nt">x_head</span><span class="o">:&gt;</span><span class="nv">x</span><span class="p">,</span><span class="o">...</span><span class="p">}</span></code> 可以防止 <code class="highlight"><span class="nb">Head</span></code> 为 <code class="highlight"><span class="nv">head</span></code> 的子表达式被匹配，称为哑规则 (dummy rule)；另一方面，其余的规则应避免此类不改变表达式的行为，以防止子表达式被遮蔽。例如：</p>
<div class="admonition wl">
<p class="admonition-title">Example</p>
<div class="highlight"><pre><span></span><code><span class="nb">ReplaceAll</span><span class="p">[{</span><span class="nv">f</span><span class="p">[</span><span class="nv">x</span><span class="p">],</span><span class="nv">x</span><span class="p">},{</span><span class="nt">x_f</span><span class="o">:&gt;</span><span class="nv">x</span><span class="p">,</span><span class="nv">x</span><span class="o">-&gt;</span><span class="nv">y</span><span class="p">}]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nb">Out</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nv">f</span><span class="p">[</span><span class="nv">x</span><span class="p">],</span><span class="nv">y</span><span class="p">}</span>
</code></pre></div>
</div>
<p><code class="highlight"><span class="nb">With</span><span class="o">|</span><span class="nb">ReplaceAll</span></code> 等函数可将表达式注入到带有 <code class="highlight"><span class="nb">HoldAll</span></code> 属性的函数中。其中，注入模式 (injector pattern) 是一个比较灵活的技巧。例如：</p>
<div class="admonition wl">
<p class="admonition-title">Example</p>
<div class="highlight"><pre><span></span><code><span class="nb">ReplaceAll</span><span class="p">[</span><span class="nb">Hold</span><span class="p">[</span><span class="m">1</span><span class="o">+</span><span class="m">1</span><span class="p">],</span><span class="nb">Hold</span><span class="p">[</span><span class="nt">x_</span><span class="p">]</span><span class="o">:&gt;</span><span class="nb">Hold</span><span class="p">[</span><span class="nv">x</span><span class="p">,</span><span class="nv">x</span><span class="p">]]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nb">Out</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Hold</span><span class="p">[</span><span class="m">1</span><span class="o">+</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="o">+</span><span class="m">1</span><span class="p">]</span>
</code></pre></div>
</div>
<p><code class="highlight"><span class="nb">RuleCondition</span></code> 是一个常用且稳定的无文档函数，可实现替换时的计算 (in-place evaluation)。例如：</p>
<div class="admonition wl">
<p class="admonition-title">Example</p>
<div class="highlight"><pre><span></span><code><span class="nb">ReplaceAll</span><span class="p">[</span><span class="nb">Hold</span><span class="p">[</span><span class="nv">f</span><span class="p">[</span><span class="nv">x</span><span class="p">]],</span><span class="nv">f</span><span class="p">[</span><span class="nt">x_</span><span class="p">]</span><span class="o">:&gt;</span><span class="nb">Identity</span><span class="p">[</span><span class="nv">x</span><span class="p">]]</span>

<span class="nb">ReplaceAll</span><span class="p">[</span><span class="nb">Hold</span><span class="p">[</span><span class="nv">f</span><span class="p">[</span><span class="nv">x</span><span class="p">]],</span><span class="nv">f</span><span class="p">[</span><span class="nt">x_</span><span class="p">]</span><span class="o">:&gt;</span><span class="nb">RuleCondition</span><span class="o">@</span><span class="nb">Identity</span><span class="p">[</span><span class="nv">x</span><span class="p">]]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nb">Out</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Hold</span><span class="p">[</span><span class="nb">Identity</span><span class="p">[</span><span class="nv">x</span><span class="p">]]</span>

<span class="nb">Out</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Hold</span><span class="p">[</span><span class="nv">x</span><span class="p">]</span>
</code></pre></div>
</div>
<h2 id="decoupling">Decoupling</h2>
<p>减少不同功能的函数与扩展包之间的关联。</p>
<h2 id="helper-function">Helper function</h2>
<p>复杂的主体函数应分层，最外层提供用户接口，若干内层的辅助函数实现不同功能，尽可能使函数的依赖关系为树状结构。为了避免重复判定条件，仅在最外层使用判别函数。</p>
<h2 id="hold-like-attributes">Hold-like attributes</h2>
<p>需注意 <code class="highlight"><span class="nb">HoldAll</span></code> 或类似属性在多层函数之间的正确传递。</p>
<h2 id="set-in-package">Set in package</h2>
<p>当 <code class="highlight"><span class="nb">Set</span></code> 出现在扩展包中时，需注意相关符号在扩展包多次被调用后的状态，或在定义前清除原始值。</p>
<h2 id="public-variable">Public variable</h2>
<p>处理公共变量 <code class="highlight"><span class="nv">var</span><span class="o">=...</span></code> 时：</p>
<ul>
<li>
<p>需注意状态的管理；</p>
</li>
<li>
<p>与 <code class="highlight"><span class="nb">HoldAll</span></code> 等非标准计算的交互。</p>
</li>
</ul>
<!-- ## Names

直到 14.0 版本，``#!wl Names[{"ctx`*"}]`` 会搜索多层的上下文，``#!wl Names["ctx`*"]`` 仅搜索一层，因此更快。例如 ``#!wl ctx`sub`fun`` 不会被后者搜索到。 -->

<!-- Source file information -->


<!-- Was this page helpful? -->




<!-- Comment system -->

                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tracking", "navigation.tabs", "navigation.top", "header.autohide", "search.suggest", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="../../../js/random-text.js"></script>
      
        <script src="../../../js/box-thm.js"></script>
      
        <script src="../../../js/mathjax-setting.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="../../../js/tikzjax.js"></script>
      
    
  </body>
</html>